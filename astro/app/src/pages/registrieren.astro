
---
import Layout from '../layouts/Layout.astro';
import { db, Kunde } from 'astro:db';

if (Astro.request.method === 'POST') {
  // parse form data
  const formData = await Astro.request.formData();
  const formcode = formData.get('code');
  const name = formData.get('familienname');
  const adresse = formData.get('adresse');
  // console.log('Formdata: ', {formcode, name, adresse});
  if (typeof formcode === 'string' && typeof name === 'string' && typeof adresse === 'string') {
    let code: number;
    if (formcode.match(/^\d+$/)) {
      code = Number(formcode);
			const anlageAm = new Date();
			await db.insert(Kunde).values({code, name, adresse, anlageAm});
    }
  } else {
    console.log('error');
  }
}
---
<Layout title="Lucas Delivery">
	<main>
    <h1>Registrieren</h1>
    <section>
      <form method="POST">
        <div>
          <label for="code">Wunschcode:</label>
          <input type="number" id="code" name="code" />
          <span class="hint">Dieser Code dient der Identifizierung bei der Bestellung. Er sollte relativ sicher sein, damit kein Fremder f√ºr dich Bestellungen aufgeben kann.</span>
        </div>
        <div>
          <label for="familienname">Familienname:</label>
          <input type="text" id="familienname" name="familienname" />
        </div>
        <div>
          <label for="adresse">Adresse:</label>
          <input type="text" id="adresse" name="adresse" />
        </div>
        <button type="submit">Registrieren</button>
      </form>
    </section>
  </main>
</Layout>

<style>
	

	.astro-a {
		position: absolute;
		top: -32px;
		left: 50%;
		transform: translatex(-50%);
		width: 220px;
		height: auto;
		z-index: -1;
	}
	
	.text-gradient {
		background-image: var(--accent-gradient);
		-webkit-background-clip: text;
		-webkit-text-fill-color: transparent;
		background-size: 400%;
		background-position: 0%;
	}
	
</style>
